shadow$provide.module$node_modules$$criipto$auth_js$dist$criipto_auth=function(global,require,module,exports){!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CriiptoAuth=t():e.CriiptoAuth=t()}(self,function(){return(()=>{function n$jscomp$1(e){return window.btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function r$jscomp$1(e$jscomp$0){return e$jscomp$0&&
e$jscomp$0.length?((e$jscomp$0.startsWith("?")||e$jscomp$0.startsWith("#"))&&(e$jscomp$0=e$jscomp$0.replace(/^(\?|#)/,"")),e$jscomp$0.split("\x26").reduce((e,t)=>{t=t.split("\x3d");return e[t[0]]=decodeURIComponent(t[1]),e},{})):{}}function i$jscomp$0(e){return Object.assign(Object.assign({},r$jscomp$1(e.search)),r$jscomp$1(e.hash))}var e$jscomp$2={d:(t,o)=>{for(var n in o)e$jscomp$2.o(o,n)&&!e$jscomp$2.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,
t)},t$jscomp$1={};e$jscomp$2.d(t$jscomp$1,{default:()=>u});const o=["redirect","popup"];class c$jscomp$0{constructor(e){this.criiptoAuth=e}authorize(e$jscomp$0){return this.criiptoAuth.generatePKCE(e$jscomp$0.redirectUri||this.criiptoAuth.options.redirectUri).then(t=>this.criiptoAuth.buildAuthorizeUrl(this.criiptoAuth.buildAuthorizeParams(Object.assign(Object.assign({},e$jscomp$0),{responseMode:"query",responseType:"code",pkce:t}))).then(e=>{window.location.href=e}))}match(){const e=i$jscomp$0(window.location);
return this.criiptoAuth.processResponse(e)}}class a$jscomp$0{constructor(e){this.criiptoAuth=e;this.backdrop=new d(this)}open(e$jscomp$0){let {width:t$jscomp$0,height:o$jscomp$0}=e$jscomp$0,n$jscomp$0=function(e,t){var o={},n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&
(o[n[r]]=e[n[r]])}return o}(e$jscomp$0,["width","height"]);return this.criiptoAuth.generatePKCE(n$jscomp$0.redirectUri||this.criiptoAuth.options.redirectUri).then(e=>{e=this.criiptoAuth.buildAuthorizeParams(Object.assign(Object.assign({},n$jscomp$0),{responseMode:"query",responseType:"code",pkce:e}));return this.criiptoAuth.buildAuthorizeUrl(e)}).then(e=>{var n,r,i,s,p,c;t$jscomp$0=t$jscomp$0||330;o$jscomp$0=o$jscomp$0||600;const a=null!==(n=window.screenLeft)&&void 0!==n?n:window.screenX;n=null!==
(r=window.screenTop)&&void 0!==r?r:window.screenY;r=null!==(s=null!==(i=window.innerWidth)&&void 0!==i?i:document.documentElement.clientWidth)&&void 0!==s?s:screen.width;i=null!==(c=null!==(p=window.innerHeight)&&void 0!==p?p:document.documentElement.clientHeight)&&void 0!==c?c:screen.height;p=r/window.screen.availWidth;return window.open(e,"CRIIPTO_POPUP_ID",`width=${t$jscomp$0},height=${o$jscomp$0},top=${(i-o$jscomp$0)/2/p+n},left=${(r-t$jscomp$0)/2/p+a}`)}).then(e=>(this.window=e,e))}authorize(e$jscomp$0){return this._latestParams=
e$jscomp$0,this.backdrop.render(e$jscomp$0),this.open(e$jscomp$0).then(()=>new Promise((e,t)=>{const o=n=>{n.source===this.window&&((n="CRIIPTO_AUTHORIZE_RESPONSE"===(n.data.startsWith("CRIIPTO_AUTHORIZE_RESPONSE")?"CRIIPTO_AUTHORIZE_RESPONSE":null)?JSON.parse(n.data.replace("CRIIPTO_AUTHORIZE_RESPONSE","")):null)&&n.error||n&&(n.code||n.id_token))&&(this.criiptoAuth.processResponse(n).then(e,t),window.removeEventListener("message",o))};window.addEventListener("message",o)})).finally(()=>{this.backdrop.remove()})}close(){this.window.close()}callback(e){if(!e)throw Error("popup.callback required argument origin");
const t=i$jscomp$0(window.location);window.opener.postMessage("CRIIPTO_AUTHORIZE_RESPONSE"+JSON.stringify(t),e);window.close()}}class d{constructor(e){this.template=null;this.popup=e;this.enabled=!0;this.handleOpen=this.handleOpen.bind(this);this.handleCancel=this.handleCancel.bind(this)}render(e){var t,o,n;const r=document.getElementById("criipto_popup_backdrop"),i=(null!==(t=this.template)&&void 0!==t?t:"da"==e.uiLocales)?'\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-background"\x3e\x3c/div\x3e\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-content"\x3e\n  \x3cp\x3eKan du ikke se pop-uppen?\x3c/p\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_open"\x3eÅben popup\x3c/button\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_close"\x3eFortryd\x3c/button\x3e\n\x3c/div\x3e\n':
"se"==e.uiLocales||"sv"==e.uiLocales?'\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-background"\x3e\x3c/div\x3e\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-content"\x3e\n  \x3cp\x3eSer du inte inloggningspopupen?\x3c/p\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_open"\x3eÖppna popup igen\x3c/button\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_close"\x3eAvbryt\x3c/button\x3e\n\x3c/div\x3e\n':"nb"==e.uiLocales?'\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-background"\x3e\x3c/div\x3e\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-content"\x3e\n  \x3cp\x3eSer du ikke popup-dialogboksen for pålogging?\x3c/p\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_open"\x3eÅpne popup på nytt\x3c/button\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_close"\x3eAvbryt\x3c/button\x3e\n\x3c/div\x3e\n':
'\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-background"\x3e\x3c/div\x3e\n\x3cdiv class\x3d"criipto-auth-popup-backdrop-content"\x3e\n  \x3cp\x3eDon\'t see the login popup?\x3c/p\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_open"\x3eReopen popup\x3c/button\x3e\n  \x3cbutton id\x3d"criipto_popup_backdrop_button_close"\x3eCancel\x3c/button\x3e\n\x3c/div\x3e\n';r||(e=document.createElement("div"),e.id="criipto_popup_backdrop",e.className="criipto-auth-popup-backdrop",e.innerHTML=i,document.body.appendChild(e),
null===(o=document.getElementById("criipto_popup_backdrop_button_open"))||void 0===o||o.addEventListener("click",this.handleOpen),null===(n=document.getElementById("criipto_popup_backdrop_button_close"))||void 0===n||n.addEventListener("click",this.handleCancel))}handleOpen(){this.popup.open(this.popup._latestParams)}handleCancel(){this.remove();this.popup.close()}remove(){document.body.removeChild(document.getElementById("criipto_popup_backdrop"))}}const u=class{constructor(e$jscomp$0){if(!e$jscomp$0.domain||
!e$jscomp$0.clientID||!e$jscomp$0.store)throw Error("new criipto.Auth({domain, clientID, store}) required");this.options=e$jscomp$0;this.domain=e$jscomp$0.domain;this.clientID=e$jscomp$0.clientID;this.store=e$jscomp$0.store;this.popup=new a$jscomp$0(this);this.redirect=new c$jscomp$0(this);this._openIdConfiguration=new class extends class{}{constructor(e){super();this.authority=e}fetchMetadata(){return window.fetch(`${this.authority}/.well-known/openid-configuration`).then(e=>e.json()).then(e=>{Object.assign(this,
e)})}}(`https://${this.domain}`)}_setup(){return this._setupPromise||(this._setupPromise=this._openIdConfiguration.fetchMetadata()),this._setupPromise}authorizeResponsive(e){for(let [n,r]of Object.entries(e)){if(!o.includes(r.via))throw Error("Unknown match.via");if(window.matchMedia(n).matches){var t=r;break}}if(void 0===t)throw Error("No media queries matched");({via:e}=t);var t$jscomp$0=["via"],o$jscomp$0={},n$jscomp$0;for(n$jscomp$0 in t)Object.prototype.hasOwnProperty.call(t,n$jscomp$0)&&0>t$jscomp$0.indexOf(n$jscomp$0)&&
(o$jscomp$0[n$jscomp$0]=t[n$jscomp$0]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r$jscomp$0=0;for(n$jscomp$0=Object.getOwnPropertySymbols(t);r$jscomp$0<n$jscomp$0.length;r$jscomp$0++)0>t$jscomp$0.indexOf(n$jscomp$0[r$jscomp$0])&&Object.prototype.propertyIsEnumerable.call(t,n$jscomp$0[r$jscomp$0])&&(o$jscomp$0[n$jscomp$0[r$jscomp$0]]=t[n$jscomp$0[r$jscomp$0]])}if("redirect"===e)return this.redirect.authorize(o$jscomp$0);if("popup"===e)return this.popup.authorize(o$jscomp$0);
throw Error("Invalid media query");}buildAuthorizeUrl(e){return this._setup().then(()=>{if(!this._openIdConfiguration.response_modes_supported.includes(e.responseMode))throw Error(`responseMode must be one of ${this._openIdConfiguration.response_modes_supported.join(",")}`);if(!this._openIdConfiguration.response_types_supported.includes(e.responseType))throw Error(`responseType must be one of ${this._openIdConfiguration.response_types_supported.join(",")}`);if(e.acrValues&&!this._openIdConfiguration.acr_values_supported.includes(e.acrValues))throw Error(`acrValues must be one of ${this._openIdConfiguration.acr_values_supported.join(",")}`);
if(!e.redirectUri)throw Error("redirectUri must be defined");const t=new URL(`${this._openIdConfiguration.authorization_endpoint}?scope=openid`);return t.searchParams.append("client_id",this.clientID),e.acrValues&&t.searchParams.append("acr_values",e.acrValues),t.searchParams.append("redirect_uri",e.redirectUri),t.searchParams.append("response_type",e.responseType),t.searchParams.append("response_mode",e.responseMode),e.pkce&&(t.searchParams.append("code_challenge",e.pkce.code_challenge),t.searchParams.append("code_challenge_method",
e.pkce.code_challenge_method)),e.state&&t.searchParams.append("state",e.state),e.loginHint&&t.searchParams.append("login_hint",e.loginHint),e.uiLocales&&t.searchParams.append("ui_locales",e.uiLocales),t.toString()})}generatePKCE(e$jscomp$1){return function(){const e$jscomp$0=new TextEncoder,t=new Uint8Array(32);window.crypto.getRandomValues(t);const o=n$jscomp$1(t);return Promise.resolve(window.crypto.subtle.digest("SHA-256",e$jscomp$0.encode(o))).then(e=>n$jscomp$1(new Uint8Array(e))).then(e=>({code_verifier:o,
code_challenge:e,code_challenge_method:"S256"}))}().then(t=>(this.store.setItem("pkce_redirect_uri",e$jscomp$1),this.store.setItem("pkce_code_verifier",t.code_verifier),t))}processResponse(e$jscomp$0){if(e$jscomp$0.error)return Promise.reject(e$jscomp$0.error);if(e$jscomp$0.id_token)return Promise.resolve(e$jscomp$0);if(!e$jscomp$0.code)return Promise.resolve(null);const t=this.store.getItem("pkce_code_verifier");if(!t)return Promise.resolve(e$jscomp$0);const o=e$jscomp$0.state,n=new URLSearchParams;
return n.append("grant_type","authorization_code"),n.append("code",e$jscomp$0.code),n.append("client_id",this.clientID),n.append("redirect_uri",this.store.getItem("pkce_redirect_uri")),n.append("code_verifier",t),this._setup().then(()=>window.fetch(this._openIdConfiguration.token_endpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"omit",body:n.toString()}).then(e=>e.json()).then(e=>Object.assign(Object.assign({},e),{state:o})))}buildAuthorizeParams(e){const t=
e.redirectUri||this.options.redirectUri,o=e.responseMode||this.options.responseMode||"query",n=e.responseType||this.options.responseType||"code",r=e.acrValues||this.options.acrValues;if(!t)throw Error("redirectUri must be defined");return{redirectUri:t,responseMode:o,responseType:n,acrValues:r,pkce:e.pkce,state:e.state}}};return t$jscomp$1.default})()})}
//# sourceMappingURL=module$node_modules$$criipto$auth_js$dist$criipto_auth.js.map
